<!DOCTYPE html><html amp=""><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# website: http://ogp.me/ns/websaite#">
        <meta charset="utf-8">
        <script async="" src="https://cdn.ampproject.org/v0.js"></script>
        <script async="" custom-element="amp-analytics" src="https://cdn.ampproject.org/v0/amp-analytics-0.1.js"></script>
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
        <meta property="og:type" content="article">
        <meta property="og:url" content="https://amp.kbys.tk/5dc2e40203ee640017974f29.html">
        <meta property="og:title" content="emoji selector - yutarobox | I am Electrical machine">
        <meta property="og:site_name" content="I am Electrical machine">
        
                <meta name="twitter:card" content="summary">
              
        
        <style amp-boilerplate="">
          body {
            -webkit-animation: -amp-start 8s steps(1, end) 0s 1 normal both;
            -moz-animation: -amp-start 8s steps(1, end) 0s 1 normal both;
            -ms-animation: -amp-start 8s steps(1, end) 0s 1 normal both;
            animation: -amp-start 8s steps(1, end) 0s 1 normal both;
          }
          @-webkit-keyframes -amp-start {
            from {
              visibility: hidden;
            }
            to {
              visibility: visible;
            }
          }
          @-moz-keyframes -amp-start {
            from {
              visibility: hidden;
            }
            to {
              visibility: visible;
            }
          }
          @-ms-keyframes -amp-start {
            from {
              visibility: hidden;
            }
            to {
              visibility: visible;
            }
          }
          @-o-keyframes -amp-start {
            from {
              visibility: hidden;
            }
            to {
              visibility: visible;
            }
          }
          @keyframes -amp-start {
            from {
              visibility: hidden;
            }
            to {
              visibility: visible;
            }
          }
        </style>
        <noscript>
          <style amp-boilerplate>
            body {
              -webkit-animation: none;
              -moz-animation: none;
              -ms-animation: none;
              animation: none;
            }
          </style>
        </noscript>
        <style amp-custom="">
          a {
  color: #0469ea;
  text-decoration: none;
}
amp-img.contain img {
  object-fit: contain;
}
blockquote {
  margin: 0;
  border-left: solid 4px #a0a0a0;
  padding-left: 4px;
  background-color: rgba(128,128,128,0.1);
}
body {
  font-family: "Roboto",Helvetica,Arial,"Hiragino Sans",sans-serif;
}
.container-0-0-1 {
  padding: 1rem;
}
@media (min-width: 640px) {
  .container-0-0-1 {
    margin: 0 auto;
    max-width: 640px;
  }
}
.logo-0-0-2 {
  display: flex;
  margin-bottom: .5rem;
  justify-content: center;
}
.imgContainer-0-0-3 {
  width: 100%;
  height: 30vh;
  position: relative;
}
.sbLink-0-0-4 {
  font-size: .7rem;
  text-align: center;
}
.sbLink-0-0-4 a {
  color: rgba(0, 0, 0, 0.7);
  text-decoration: none;
}
.level-0-0-5 {
  font-weight: bold;
}
.level-2-0-0-6 {
  font-size: 1.2em;
  line-height: 28px;
}
.level-3-0-0-7 {
  font-size: 1.44em;
  line-height: 35px;
}
.level-4-0-0-8 {
  font-size: 1.73em;
  line-height: 42px;
}
.level-5-0-0-9 {
  font-size: 2.07em;
  line-height: 49px;
}
.level-6-0-0-10 {
  font-size: 2.49em;
  line-height: 56px;
}
.level-7-0-0-11 {
  font-size: 3em;
  line-height: 63px;
}
.level-8-0-0-12 {
  font-size: 3.58em;
  line-height: 77px;
}
.level-9-0-0-13 {
  font-size: 4.3em;
  line-height: 91px;
}
.level-10-0-0-14 {
  font-size: 5.16em;
  line-height: 105px;
}
.unlinked-0-0-15 {
  color: #004bad;
}
.moreProfile-0-0-16 {
  margin: 2rem 0;
  text-align: center;
}
.moreProfile-0-0-16 a {
  color: #fff;
  padding: 1rem;
  background: linear-gradient(0deg, rgba(120,119,119,1) 0%, rgba(5,119,254,1) 100%);
  font-weight: bold;
  text-shadow: 0px 1px 2px #333;
  border-radius: 2rem;
}
.donation-0-0-17 {
  margin-top: 2rem;
  text-align: center;
}
.donation-0-0-17 a {
  color: #fff;
  padding: 1rem;
  background: linear-gradient(0deg, rgba(255,177,8,1) 0%, rgba(235,251,26,1) 100%);
  font-weight: bold;
  text-shadow: 0px 1px 2px #333;
  border-radius: 2rem;
}
        </style>
        <title>emoji selector - yutarobox | I am Electrical machine</title>
        <link rel="canonical" href="https://scrapbox.io/jigsaw/emoji selector - yutarobox">
      </head>
      <body>
        <amp-analytics type="gtag" data-credentials="include">
          <script type="application/json">
            {
              "vars": {
                "gtag_id": "UA-96527600-2",
                "config": {
                  "UA-96527600-2": { "groups": "default" }
                }
              },
              "triggers": {
                "trackPageView": {
                  "on": "visible",
                  "request": "pageview"
                }
              }
            }
          </script>
        </amp-analytics>
        <div class="container-0-0-1">
          <div class="logo-0-0-2">
            <a href="https://amp.kbys.tk">
              <amp-img src="https://i.gyazo.com/67ba2e0bfe934bd265f24e4c3cbd85a4.jpg" width="40px" height="40px"></amp-img>
            </a>
          </div>
          <div class="sbLink-0-0-4">
            <a href="https://scrapbox.io/jigsaw/emoji selector - yutarobox">
              スクボで読む
            </a>
          </div>
          <h1>emoji selector - yutarobox</h1>
          <div>
            
        <div style="padding-left:0rem; margin-bottom: .5rem;">
          
            <a href="https://scrapbox.io/yutaro/emoji_selector" target="_blank" rel="noopener">
              emoji selector - yutarobox
            </a>
          
        </div>
      
        <div style="padding-left:0rem; margin-bottom: .5rem;">
          
                <br>
              
        </div>
      
        <div style="padding-left:0rem; overflow: scroll;">
          <code>script.js</code>
          <pre><code> const Asearch = (function() {
     var INITPAT, INITSTATE, MAXCHAR;
     INITPAT = 0x80000000; 
     MAXCHAR = 0x100; 
     INITSTATE = [INITPAT, 0, 0, 0];
 
     Asearch.prototype.isupper = function(c) {
       return (c &gt;= 0x41) &amp;&amp; (c &lt;= 0x5a);
     };
 
     Asearch.prototype.islower = function(c) {
       return (c &gt;= 0x61) &amp;&amp; (c &lt;= 0x7a);
     };
 
     Asearch.prototype.tolower = function(c) {
       if (this.isupper(c)) {
         return c + 0x20;
       } else {
         return c;
       }
     };
 
     Asearch.prototype.toupper = function(c) {
       if (this.islower(c)) {
         return c - 0x20;
       } else {
         return c;
       }
     };
 
     function Asearch(source) {
       var c, i, j, len, mask, ref, ref1;
       this.source = source;
       this.shiftpat = [];
       this.epsilon = 0;
       this.acceptpat = 0;
       mask = INITPAT;
       for (c = i = 0, ref = MAXCHAR; 0 &lt;= ref ? i &lt; ref : i &gt; ref; c = 0 &lt;= ref ? ++i : --i) {
         this.shiftpat[c] = 0;
       }
       ref1 = this.unpack(this.source);
       for (j = 0, len = ref1.length; j &lt; len; j++) {
         c = ref1[j];
         if (c === 0x20) {
           this.epsilon |= mask;
         } else {
           this.shiftpat[c] |= mask;
           this.shiftpat[this.toupper(c)] |= mask;
           this.shiftpat[this.tolower(c)] |= mask;
           mask &gt;&gt;&gt;= 1;
         }
       }
       this.acceptpat = mask;
       return this;
     }
 
     Asearch.prototype.state = function(state, str) {
       var c, i, i0, i1, i2, i3, len, mask, ref;
       if (state == null) {
         state = INITSTATE;
       }
       if (str == null) {
         str = '';
       }
       i0 = state[0];
       i1 = state[1];
       i2 = state[2];
       i3 = state[3];
       ref = this.unpack(str);
       for (i = 0, len = ref.length; i &lt; len; i++) {
         c = ref[i];
         mask = this.shiftpat[c];
         i3 = (i3 &amp; this.epsilon) | ((i3 &amp; mask) &gt;&gt;&gt; 1) | (i2 &gt;&gt;&gt; 1) | i2;
         i2 = (i2 &amp; this.epsilon) | ((i2 &amp; mask) &gt;&gt;&gt; 1) | (i1 &gt;&gt;&gt; 1) | i1;
         i1 = (i1 &amp; this.epsilon) | ((i1 &amp; mask) &gt;&gt;&gt; 1) | (i0 &gt;&gt;&gt; 1) | i0;
         i0 = (i0 &amp; this.epsilon) | ((i0 &amp; mask) &gt;&gt;&gt; 1);
         i1 |= i0 &gt;&gt;&gt; 1;
         i2 |= i1 &gt;&gt;&gt; 1;
         i3 |= i2 &gt;&gt;&gt; 1;
       }
       return [i0, i1, i2, i3];
     };
 
     Asearch.prototype.match = function(str, ambig) {
       var s;
       if (ambig == null) {
         ambig = 0;
       }
       s = this.state(INITSTATE, str);
       if (!(ambig &lt; INITSTATE.length)) {
         ambig = INITSTATE.length - 1;
       }
       return (s[ambig] &amp; this.acceptpat) !== 0;
     };
 
     Asearch.prototype.unpack = function(str) {
       var bytes, c, code, i, len, ref;
       bytes = [];
       ref = str.split('');
       for (i = 0, len = ref.length; i &lt; len; i++) {
         c = ref[i];
         code = c.charCodeAt(0);
         if (code &gt; 0xFF) {
           bytes.push((code &amp; 0xFF00) &gt;&gt;&gt; 8);
         }
         bytes.push(code &amp; 0xFF);
       }
       return bytes;
     };
 
     return Asearch;
 
   })();
 
 
 
 const projectName = scrapbox.Project.name;
 let emojis = [];
 const box = $('&lt;div&gt;').addClass('form-group').css("position", "absolute");
 const container = $('&lt;div&gt;').addClass('dropdown');
 box.append(container);
 let items = $('&lt;ul&gt;').addClass('dropdown-menu');
 container.append(items);
 $('#editor').append(box);
 
 fetch(`/api/pages/${projectName}?limit=10000`, { credentials: 'same-origin'})
 	.then( res =&gt; res.text())
     .then( text =&gt; {
     	const data = JSON.parse( text );
      	const pages = data.pages;
       	pages.filter( page =&gt; (page.image !== null &amp;&amp; page.title.match(/^[\w\s\-\+]+$/)))
      		.forEach( page =&gt; {
        			emojis.push({
        				name: page.title,
            			path: page.title,
           			icon: `/api/pages/${projectName}/${page.title}/icon`,
             	})
              })
     })
 
 
 scrapbox.PageMenu.addMenu({
     title: 'emoji',
     image: 'https://gyazo.com/d57fea8a143650375af1c8bba1fc1370/raw'
 })
 scrapbox.PageMenu('emoji').addItem({
     title: "load emojis from /jgsemj",
     onClick: () =&gt; {
     	 fetch('/api/pages/jgsemj?limit=10000')
       	.then( res =&gt; res.text())
        	.then( text =&gt; {
         	const data = JSON.parse( text );
           	const pages = data.pages;
            	pages.filter( page =&gt; (page.image !== null &amp;&amp; page.title.match(/^[\w\s\-\+]+$/)))
             		.forEach( page =&gt; {
               			for( let emoji of emojis ) {
                           if( emoji.name === page.title )return;
                     	}
               			emojis.push({
                 			name: page.title,
                    			path: '/jgsemj/' + page.title,
                      		icon: `/api/pages/jgsemj/${page.title}/icon`,
                 		})
               		})
            })
     }
 })      		
 
  // TODO: 様々な文字列が来る場合を考慮する
  
  const taberareloo = ( word, list ) =&gt; {
  	const targetWord = word.replace(':', '');
  	const regStr = targetWord.split('').reduce( (pre, cur) =&gt; pre + cur + '.*' ).replace('+', '\\+');
   	const reg = RegExp(regStr,'i');
    	return list.filter( item =&gt; item.name.match(reg));
  }
  
  const asearched = ( word, list ) =&gt; {
  	const targetWord = word.replace(':', '');
   	const a = new Asearch( targetWord );
     const limitCount = Math.floor( targetWord.length/ 4 ) + 1;
     let result = [];
     
     for(let i = 0; i &lt;= limitCount; i++){
     	let matched = list.filter( item =&gt; a.match( item.name, i));
      	let notExisted = matched.filter( item =&gt; {
       		for( let r of result){
         		if(r.name === item.name){
           			return false;
           		}
         	}
          	return true;
       	})
        	result = [ ...result, ...notExisted];
     }
     
    	return result;
  }
  
  const fizzSearch = ( word, list ) =&gt; {
  	const a = asearched( word, list );
   	const b = taberareloo( word, list );
    	const c = b.filter( item =&gt; {
     	for( let r of a ){
      		if( r.name == item.name){
        			return false;
        		}
      	}
       	return true;
     })
    	return [...a, ...c];
  }
  
 
  let stack = "";
  const editor = $('#editor');
  
  const open  = () =&gt; container.addClass("open"); 
  const close = () =&gt; {
  	stack = "";
  	container.removeClass("open");
  }
  
  const replaceText = (text, cursor, emojiPath) =&gt; {
  	cursor.focus();
     setTimeout(()=&gt;{
     	for(let i = 0; i &lt; text.length; i++){
         	var ke1 = document.createEvent("Events");
          	ke1.initEvent("keydown", true, true);
          	ke1.keyCode = ke1.which = 8; // Backspace
          	cursor.dispatchEvent(ke1);
         }
         document.execCommand('insertText',null, `[${emojiPath}.icon]` );
         close();
     }, 50)
  }
  
  editor.keydown( e =&gt; {
  	const key = e.key;
   	if(key === undefined ) return;
  	if( stack === "" &amp;&amp; key !== ":"){
   		close();	
   		return
     };
 
     if ($('.cursor-line').text().trim() == 'code:'
        		|| $('.cursor-line .code-block').length == 1) {
        close()
        return;
     }
     
     if( key === ':' &amp;&amp; stack.length !== 0){
     	let name = stack.replace(':', '');
     	for(let emoji of emojis){
      		if( emoji.name === name ){
        			let cursor = $('#text-input')[0];
        			replaceText(stack + ":", cursor, emoji.path);
           		return;
        		}
      	}
       	close()
        	return;
     }
 	const cursor = $('#text-input')[0];
     if( key.match(/^[\w\s\-\:\+]$/) ){
     	stack += e.key;
      	let focused = $(':focus');
       	if(focused.is(items.find('li &gt; a'))){
      		cursor.focus();  		
        	}
     }
   
     if( stack.length === 2 ){
     	if( key === " " ){
      		stack = "";
        		return;
      	}
     	open();
      }
     
     switch(key){
     	case 'Backspace':
      		stack = stack.slice(0, stack.length - 1);
        		if(stack.length === 0){
          		close();
            		return;
          	}
        		break;
         case 'ArrowUp':
         	let focusedUp = $(':focus');
          	if( focusedUp.is(items.find('li &gt; a').eq(0)) ){
           		e.stopPropagation();
             	cursor.focus();
           	}else if( !focusedUp.is(items.find('li &gt; a')) ){
            		close();
              	return;
             }
          	break;
         case 'ArrowDown':
         	let focusedDown = $(':focus');
         	if( !focusedDown.is(items.find('li &gt; a'))) {
         		e.stopPropagation();
           		e.preventDefault();
          		items.find("li &gt; a").eq(0).focus();
             }
             break;
         case 'Escape':
         case 'ArrowLeft':
         case 'ArrowRight': 
         case 'Home':
         case 'End':
         case 'PageUp':
         case 'PageDown':
          	close();
           	break;
         
         case 'Enter':
         	if( stack.length === 1 ){
          		close();
            		break;
          	}
           	let focused = $(':focus');
           	if(!focused.is(items.find('li &gt; a'))){
            		e.stopPropagation();
                 e.preventDefault();
           		items.find('li &gt; a').eq(0).click();
             }
           break;
     }
     
     if( stack.length &lt;= 1 || !key.match(/^[\w\s\:\-\+]$|Backspace/)) return;
     const matchedEmoji = fizzSearch(stack, emojis)
     if( matchedEmoji.length === 0){
     	close();
      	return;
     }
     
     const newItems = $('&lt;ul&gt;').addClass('dropdown-menu');
     
     matchedEmoji.forEach( ( emoji, index) =&gt; {
       if( index &gt; 30 ) return;
       const li = $('&lt;li&gt;').addClass('dropdown-item');
       const a  = $('&lt;a&gt;').attr("tabindex", "0");
       const img = $('&lt;img&gt;').attr("src", emoji.icon)
          .addClass("icon").css({ height: "17px", float: "left"});
       const nameTag = $('&lt;div&gt;').text("  :" + emoji.name + ":");
       a.append(img);
       a.append(nameTag);
       li.append(a);
       newItems.append(li);
 	
       a.on('click', () =&gt; {
        	cursor.focus();
         replaceText(stack, cursor, emoji.path);
       })
       
       a.on('keypress', ev =&gt; {
       	 if(ev.key === "Enter"){
         	ev.preventDefault();
          	ev.stopPropagation();
          	replaceText(stack, cursor, emoji.path);
          }
       })
 	})
  	
   	items.replaceWith(newItems);
   	items = newItems;
     let css = {};
    	cursor.style.cssText.split(';').filter( text =&gt; text !== '' )
     	.forEach( text =&gt; {
      		const props = text.split(':').map( text =&gt; text.replace(' ', '').replace('px', ''));
        		css[props[0]] = props[1];
     	});
     
   	box.css({
    		top: `${parseInt(css.top) + parseInt(css.height) + 3}px`,
      	left: `${css.left}px`,
    	});
  })</code></pre>
        </div>
      
        <div style="padding-left:0rem; margin-bottom: .5rem;">
          
                <br>
              
        </div>
      
        <div style="padding-left:0rem; margin-bottom: .5rem;">
          
          <span class="unlinked-0-0-15">#UserScript</span>
         
          <span class="unlinked-0-0-15">#絵文字</span>
        
        </div>
      
        <div style="padding-left:0rem; margin-bottom: .5rem;">
          
          <span class="unlinked-0-0-15">#20191107</span>
         
          <a href="https://amp.kbys.tk/5dc2e464d243c800176838aa">#1107</a>
        
        </div>
      
          </div>
          <h2>関連ページとランダムに選ばれたページ</h2>
          <ul>
            
                  <li>
                    <a href="https://amp.kbys.tk/5dc2e464d243c800176838aa.html">
                      1107
                    </a>
                  </li>
                
                  <li>
                    <a href="https://amp.kbys.tk/5c3c04e1be23a10017086e69.html">
                      githubのtimelineがbigqueryで解析できる - dev.jgs.me
                    </a>
                  </li>
                
                  <li>
                    <a href="https://amp.kbys.tk/5c6a3349595ea90017209da5.html">
                      フロントエンドエンジニアのための動画ストリーミング技術基礎 | ygoto3.com - github.com/e-jigsaw/web
                    </a>
                  </li>
                
                  <li>
                    <a href="https://amp.kbys.tk/5c2b9af65513850017f82cf5.html">
                      ワイルド・スピード SKY MISSION - diary.jgs.me
                    </a>
                  </li>
                
                  <li>
                    <a href="https://amp.kbys.tk/5de57887971ec40017fc06a8.html">
                      1203
                    </a>
                  </li>
                
          </ul>
          <h2>筆者について</h2>
          <div>jigsaw(ジグソウ、1991年6月12日-)は日本のプログラマ、会社代表。本名は小林貴也(こばやし たかや)。主にウェブ、フロントエンド領域で活動している。カミング・スーン合同会社の代表社員。</div>
          <div class="moreProfile-0-0-16"><a href="https://amp.kbys.tk/5c29451d434bf90017d3b219.html">さらに詳しく</a></div>
          <h2>寄附について</h2>
          <div>面白かったら<a href="https://amp.kbys.tk/5dcc34d2e8364600170f07f6.html">BTC</a>や<a href="https://amp.kbys.tk/5dcc35503afcd0001731ff2c.html">ETH</a>での寄附をお待ちしております。</div>
          <div class="donation-0-0-17"><a href="https://amp.kbys.tk/5dbbc52057d9010017438a87">寄附のきろく</a></div>
        </div>
      
    
  </body></html>